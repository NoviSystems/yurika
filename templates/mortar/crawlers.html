{% extends "base.html" %}

{% block content %}
<div class="visible-desktop container body-wrapper">
<h1>Crawlers
<a id="toggle_form" href="#crawler_form" class="btn btn-xs btn-primary" data-toggle="collapse">+</a>
</h1>
<div id="crawler_form" class="collapse">
<form id="new_crawler" action="" method="POST" novalidate>
  {% csrf_token %}
  <div class="form-group row">
    <div class="col-xs-2">
      <label class="control-label" for="name">
        {{ new_crawler_form.name.label }} 
      </label>
      {{ new_crawler_form.name }}
    </div>
    <div class="col-xs-2" id="crawler_category">
      <label class="control-label" for="category">
        {{ new_crawler_form.category.label }}  
      </label>
      {{ new_crawler_form.category }}
    </div>
    <div class="col-xs-2">
      <label class="control-label" for="index">
        {{ new_crawler_form.index.label }}  
      </label>
      {{ new_crawler_form.index }}
      <div id="index_form" class="collapse in">
        {{ new_crawler_form.new_index }}
      </div>
    </div>
    <div class="col-xs-4">
      <div id="form_seed_list">
        <label class="control-label" for="seed_list">
          Seed List
        </label> (one per line)
        <textarea class="form-control" name="seed_list" id="seed_list"></textarea>
      </div>
    </div>
    <div class="col-xs-2">
      <label class="control-label" for="new_crawler"></label>
      <button class="btn btn-success" type="submit" name="new_crawler" value="submit">Create Crawler</button>
    </div>
  </div>
</form>
</div>
<div id="crawler_list" class="table-responsive" data-toggle="tooltip" data-html="true">
  <table class="table table-striped">
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Elastic Index</th>
      <th>Status</th>
    </tr>
    {% for crawler in crawlers %}
      <tr>
        <td>{{ crawler.name }}</td>
        <td>{{ crawler.category }}</td>
        <td>{{ crawler.index.name }}</td>
        <td>{{ crawler.status }}
            <form action="" method="POST">
              {% csrf_token %}
                {% if crawler.status == 'Running' %}
                  <button class="btn btn-primary" name="{{ crawler.pk }}-toggle" value="stop">Stop</button>
                {% else %}
                  <button class="btn btn-primary" name="{{ crawler.pk }}-toggle" value="start">Start</button>
                {% endif %}
              </button>
            </form>
        </td>
      </tr>
    {% endfor %}
  </table>
</div>
</div>
{% endblock %}
{% block scripts %}
<script>
$(document).ready(function() {
  $('#toggle_form').click(function() {
    if($('#crawler_form').hasClass('in')) {
      $('#toggle_form').text('+');
      $('#toggle_form').removeClass('btn-danger');
      $('#toggle_form').addClass('btn-primary');
    } else {
      $('#toggle_form').html('&times;');
      $('#toggle_form').removeClass('btn-primary');
      $('#toggle_form').addClass('btn-danger');
    }
  }); 
  $('#id_index').change(function() {
    if($("#id_index").val() == null) {
      $('#index_form').addClass('in');
    }
    else {
      $('#index_form').removeClass('in');
    }
  });
});
</script>
{% endblock %}
